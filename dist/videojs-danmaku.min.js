!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).videojs)}(this,function(t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=e(t),s={submit:t=>{}};const a=n.default.registerPlugin||n.default.plugin,u=n.default.getComponent("Component");class d extends u{constructor(t,e){super(t,e),this.options=e,this.player=t}submit(t){this.options.submit({progress:parseInt(this.player.currentTime()),comment:t,username:"me"})}createEl(){var t=n.default.dom.createEl("div",{className:"vjs-danmaku-editor"});let e=n.default.dom.createEl("input",{className:"vjs-danmaku-input",type:"text"});var a=n.default.dom.createEl("button",{className:"vjs-danmaku-button"});return n.default.dom.textContent(a,"Sent"),n.default.on(a,"click",()=>{e.value&&this.submit(e.value),e.value=""}),n.default.dom.appendContent(t,e),n.default.dom.appendContent(t,a),t}}class o extends u{constructor(e,t){super(e,t),this.danmakuMap={},t.danmaku.length&&t.danmaku.forEach(t=>{t.progress in this.danmakuMap||(this.danmakuMap[t.progress]=[]),this.danmakuMap[t.progress].push(t)});let a;e.on("timeupdate",()=>{var t=parseInt(e.currentTime());t!==a&&(a=t)in this.danmakuMap&&this.danmakuMap[t].forEach(t=>this.addItem(t))})}append(t){var e=t.progress++;e in this.danmakuMap?this.danmakuMap[e].push(t):this.danmakuMap[e]=[t]}createEl(){return this.layout=n.default.dom.createEl("div",{className:"vjs-danmaku-layout"}),this.layout}addItem(t){var e=n.default.dom.createEl("div",{className:"vjs-danmaku-item"});n.default.dom.textContent(e,`${t.username}: ${t.comment}`),n.default.dom.appendContent(this.layout,e),setTimeout(()=>{this.layout.removeChild(e)},5e3)}}u.registerComponent("DanmakuEditor",d),u.registerComponent("DanmakuLayout",o);a("danmakus",function(t){this.ready(()=>{let e=n.default.mergeOptions(s,t);const a=this.addChild("DanmakuLayout",e);this.controlBar.addChild("DanmakuEditor",{...e,submit:t=>{a.append(t),e.submit(t)}},15)})})});
